<!--interactive_bar_chart.html-->

<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Interactive Obesity Distribution Bar Chart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      color: #333;
    }
    nav {
      background-color: #005599;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 0.8rem;
      margin-bottom: 20px;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    nav a:hover {
      background-color: #0077cc;
    }
    h2 {
      text-align: center;
      color: #2c3e50;
    }
    p.description {
      text-align: center;
      max-width: 800px;
      margin: 0 auto 20px;
      font-size: 16px;
    }
    #vis {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-top: 20px;
    }
  </style>
  <!-- Load Vega, Vega-Lite & Vega-Embed libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <!-- Load the unified page header -->
  <div id="shared-header"></div>
  <script>
    fetch("header.html")
      .then(response => response.text())
      .then(data => document.getElementById("shared-header").innerHTML = data)
      .catch(console.error);
  </script>

  <h2>Distribution of Obesity Levels by Gender and Age Group</h2>
  <p class="description">
    This interactive bar chart displays the distribution of obesity levels within the population.
    Use the dropdown filters to explore patterns by gender and age group. Hover over each bar
    to see detailed counts.
  </p>

  <div id="vis"></div>

  <script>
    (function(vegaEmbed) {
      var spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
          "url": "ObesityDataSet_raw_and_data_sinthetic.csv",
          "format": {"type": "csv"}
        },
        "params": [
          {
            "name": "gender_filter",
            "bind": {
              "input": "select",
              "options": ["All", "Male", "Female"],
              "name": "Select Gender: "
            },
            "value": "All"
          },
          {
            "name": "age_filter",
            "bind": {
              "input": "select",
              "options": ["All", "10-20", "20-30", "30-40", "40-50", "50-60", "60+"],
              "name": "Select Age Group: "
            },
            "value": "All"
          }
        ],
        "transform": [
          {
            "calculate": "datum.Age < 20 ? '10-20' : datum.Age < 30 ? '20-30' : datum.Age < 40 ? '30-40' : datum.Age < 50 ? '40-50' : datum.Age < 60 ? '50-60' : '60+'",
            "as": "age_group"
          },
          { "filter": "gender_filter === 'All' || datum.Gender === gender_filter" },
          { "filter": "age_filter === 'All' || datum.age_group === age_filter" }
        ],
        "selection": {
          "hover": {
            "type": "single",
            "on": "mouseover",
            "empty": "none"
          }
        },
        "mark": {
          "type": "bar",
          "cornerRadius": 3
        },
        "encoding": {
          "x": {
            "field": "NObeyesdad",
            "type": "nominal",
            "title": "Obesity Level",
            "axis": {"labelAngle": 45},
            "sort": {"op": "count", "order": "descending"}
          },
          "y": {
            "aggregate": "count",
            "type": "quantitative",
            "title": "Number of People"
          },
          "color": {
            "field": "NObeyesdad",
            "type": "nominal",
            "title": "Obesity Level"
          },
          "opacity": {
            "condition": {"selection": "hover", "value": 1},
            "value": 0.8
          },
          "tooltip": [
            {"field": "NObeyesdad", "type": "nominal", "title": "Obesity Level"},
            {"aggregate": "count", "type": "quantitative", "title": "Total Count"}
          ]
        },
        "width": 600,
        "height": 400,
        "title": {
          "text": "Distribution of Obesity Levels by Gender and Age Group",
          "fontSize": 18,
          "anchor": "middle"
        },
        "config": {
          "axis": {"labelFontSize": 12},
          "title": {"fontSize": 16}
        }
      };

      vegaEmbed("#vis", spec, {mode: "vega-lite"}).catch(function(err) {
        document.getElementById("vis").innerHTML = "<p style='color:red;'>Error: " + err.message + "</p>";
        console.error(err);
      });
    })(vegaEmbed);
  </script>
</body>
</html>

